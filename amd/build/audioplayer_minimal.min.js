define(["jquery","core/log"],function(a,b){var c={hiddenplayer:"_fpminimal_hiddenaudioplayer",player:"_fpminimal_audioplayer",ppbutton:"_fpminimal_audioplayer .fpminimal_audioplayer_play_button",bar_front:"_fpminimal_audioplayer .fpminimal_audioplayer_bar_front",backbutton:"_fpminimal_audioplayer .fpminimal_audioplayer_skip_button_back",forwardbutton:"_fpminimal_audioplayer .fpminimal_audioplayer_skip_button_forward",timedisplay:"_fpminimal_audioplayer .fpminimal_audioplayer_time"},d=require.toUrl("filter/poodll/pix/fpminimal_play.png"),e=require.toUrl("filter/poodll/pix/fpminimal_stop.png"),f=15;return{init:function init(d){this.hplayer=a(d.player_element)[0];b.debug(d.player_element);b.debug(d.autoid);b.debug(d);if(1==a(this.hplayer).data("init")){return}else{a(this.hplayer).data("init",1)}this.vplayer=a("#"+d.autoid+c.player);this.ppbutton=a("#"+d.autoid+c.ppbutton);this.bar_front=a("#"+d.autoid+c.bar_front);this.backbutton=a("#"+d.autoid+c.backbutton);this.forwardbutton=a("#"+d.autoid+c.forwardbutton);this.timedisplay=a("#"+d.autoid+c.timedisplay);this.duration=this.hplayer.duration;b.debug("duration is "+this.duration);this.register_events();this.update_time()},register_events:function register_events(){var b=this;a(this.ppbutton).on("click",function(){b.toggle_play()});a(this.backbutton).on("click",function(){b.skip_back()});a(this.forwardbutton).on("click",function(){b.skip_forward()});a(this.hplayer).on("timeupdate",function(){b.update_time()});a(this.hplayer).on("ended",function(){a(b.ppbutton).css("background-image",d);a(b.timedisplay).text(b.formatAudioTime(b.duration))});a(this.hplayer).on("loadeddata",function(){console.log("loadeddata",b.hplayer.duration);if(b.hplayer.duration===1/0){b.duration=a(b.hplayer).data("duration")}else{b.duration=b.hplayer.duration}b.update_time()});a(this.hplayer).on("canplaythrough",function(){if(b.hplayer.duration!==1/0){b.duration=b.hplayer.duration}})},toggle_play:function toggle_play(){var c=this;if(this.hplayer.paused){this.hplayer.muted=!1;console.log(this.hplayer);this.hplayer.play().then(function(){b.debug("play promise resolved");a(c.ppbutton).css("background-image",e)}).catch(function(a){b.debug(a,"play promise rejected")})}else{this.hplayer.pause();a(this.ppbutton).css("background-image:",d)}},update_time:function update_time(){var b=0;if(0<parseInt(this.duration)){b=100*(this.hplayer.currentTime/this.duration);if(100<b){b=100}}else{this.duration=0}a(this.bar_front).css("width",b+"%");switch(b){case 0:a(this.timedisplay).text(this.formatAudioTime(this.duration));break;case 100:a(this.timedisplay).text(this.formatAudioTime(this.duration));break;default:a(this.timedisplay).text(this.formatAudioTime(this.hplayer.currentTime)+"/"+this.formatAudioTime(this.duration));}if(this.hplayer.currentTime<f){a(this.backbutton).css("opacity","50%")}else{a(this.backbutton).css("opacity","100%")}if(this.hplayer.currentTime>this.duration-f){a(this.forwardbutton).css("opacity","50%")}else{a(this.forwardbutton).css("opacity","100%")}},skip_back:function skip_back(){if(this.hplayer.currentTime>f){this.hplayer.currentTime=this.hplayer.currentTime-f}else{this.hplayer.currentTime=0}},skip_forward:function skip_forward(){if(this.hplayer.currentTime<this.duration-f){this.hplayer.currentTime=this.hplayer.currentTime+f}else{this.hplayer.currentTime=this.duration}},formatAudioTime:function formatAudioTime(a){var b=Math.floor(a/60),c=Math.floor(a%60),d="".concat((b+"").padStart(2,"0"),":").concat((c+"").padStart(2,"0"));return d}}});
//# sourceMappingURL=audioplayer_minimal.min.js.map
