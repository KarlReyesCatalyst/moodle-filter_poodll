define(["jquery","core/log","filter_poodll/utils_amd","filter_poodll/uploader","filter_poodll/react_amd","filter_poodll/literallycanvas"],function(a,b,c,d,e,f){"use strict";return b.debug("Filter PoodLL: literallycanvas.js initialising"),{loadliterallycanvas:function(b){var c="#amdopts_"+b.recorderid,e=a(c).get(0);e&&(b=JSON.parse(e.value),this.config=b,a(c).remove());var g="#"+b.recorderid+"_literally",h=a(g)[0],i=4,j=.2;if(b.whiteboardnozoom>0&&(i=1,j=1),b.backgroundimage){var k=a("#"+b.recorderid+"_separate-background-image")[0],l=new Image;l.src=k.src,l.crossOrigin="Anonymous";var m=f.createShape("Image",{x:0,y:0,image:l,scale:1}),n=f.init(h,{imageURLPrefix:b.imageurlprefix,backgroundColor:b.backgroundcolor,backgroundShapes:[m],recorderid:b.recorderid,zoomMax:i,zoomMin:j})}else var n=f.init(h,{imageURLPrefix:b.imageurlprefix,backgroundColor:b.backgroundcolor,recorderid:b.recorderid,zoomMax:i,zoomMin:j});this.lc=n,d.init(g,b);var o=b.vectordata;o&&(0!=o.indexOf('{"shapes"')&&0!=o.indexOf('{"colors"')||n.loadSnapshot(JSON.parse(o))),this.registerEvents()},registerEvents:function(){var b=this,e=this.config,f=e.recorderid;e.autosave?this.lc.on("drawingChange",function(){var d=a("#"+f+"_messages")[0],g=a("#"+f+"_btn_upload_whiteboard")[0];if(d){g&&(g.disabled=!1),d.innerHTML="";var h=c.timeouthandles[f];h&&clearTimeout(h),c.timeouthandles[f]=setTimeout(function(){c.WhiteboardUploadHandler(f,b.lc,e)},e.autosave)}}):this.lc.on("drawingChange",function(){var b=a("#"+f+"_messages");b&&(b.innerHTML="File has not been saved.")});var g="#"+f+"_btn_upload_whiteboard",h=a(g);h&&(e.autosave?h.click(function(){c.WhiteboardUploadHandler(f,b.lc,e)}):h.click(function(){var a=c.getCvs(f,b.lc,e);c.pokeVectorData(f,b.lc,e),d.uploadFile(a.toDataURL(),"image")}))}}});