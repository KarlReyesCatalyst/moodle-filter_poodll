define(["jquery","core/log","filter_poodll/utils_amd","filter_poodll/react_amd","filter_poodll/uploader","filter_poodll/literallycanvas"],function(a,b,c,d,e,f){"use strict";return b.debug("Filter PoodLL: literallycanvas.js initialising"),{loadliterallycanvas:function(b){var d="#amdopts_"+b.recorderid,g=a(d).get(0);g&&(b=JSON.parse(g.value),this.config=b,a(d).remove()),c.whiteboardopts[b.recorderid]=b;var h="#"+b.recorderid+"_literally",i=a(h)[0];if(e.init(h,b),b.backgroundimage){var j=a("#"+b.recorderid+"_separate-background-image")[0],k=new Image;k.src=j.src,k.crossOrigin="Anonymous";var l=f.createShape("Image",{x:0,y:0,image:k,scale:1}),m=f.init(i,{imageURLPrefix:b.imageurlprefix,backgroundColor:b.backgroundcolor,backgroundShapes:[l],recorderid:b.recorderid})}else var m=f.init(i,{imageURLPrefix:b.imageurlprefix,backgroundColor:b.backgroundcolor,recorderid:b.recorderid});this.lc=m;var n=c.whiteboardopts[b.recorderid].vectordata;n&&(0==n.indexOf('{"shapes"')||0==n.indexOf('{"colors"'))&&m.loadSnapshot(JSON.parse(n)),c.whiteboards[b.recorderid]=m,this.registerEvents()},registerEvents:function(){var b=this.config.recorderid;opts.autosave?this.lc.on("drawingChange",function(){var d=a("#"+b+"_messages")[0],e=a("#"+b+"_btn_upload_whiteboard")[0];if(d){e&&(e.disabled=!1),d.innerHTML="";var f=c.timeouthandles[b];f&&clearTimeout(f),c.timeouthandles[b]=setTimeout(function(){c.WhiteboardUploadHandler(b)},c.whiteboardopts[b].autosave)}}):lc.on("drawingChange",function(){var c=a("#"+b+"_messages");c&&(c.innerHTML="File has not been saved.")});var d="#"+opts.recorderid+"_btn_upload_whiteboard",f=a(d);if(f)if(opts.autosave)f.click(function(){c.WhiteboardUploadHandler(opts.recorderid)},!1);else{var g=c.whiteboards[opts[recorderid]],h=g.canvasForExport();f.click(function(){e.uploadFile(h.ToDataURL(),"image")},!1)}}}});