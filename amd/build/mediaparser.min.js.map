{"version":3,"sources":["../src/mediaparser.js"],"names":["define","$","log","debug","parse","containerid","mediatype","ret","mediaurl","lang","subtitlesurl","sources","originalplayer","first","length","attr","addClass","originallink","split","urlParams","URLSearchParams","get"],"mappings":"AACAA,OAAM,6BAAC,CAAC,QAAD,CAAW,UAAX,CAAD,CAAyB,SAAUC,CAAV,CAAaC,CAAb,CAAkB,CAE7C,aAEAA,CAAG,CAACC,KAAJ,CAAU,4BAAV,EAEA,MAAO,CACJC,KAAK,CAAG,eAASC,CAAT,CAAsBC,CAAtB,CAAiC,IACjCC,CAAAA,CAAG,CAAG,CACNC,QADM,IAENC,IAFM,IAGNC,YAHM,IAINC,OAJM,IAD2B,CAQjCC,CAAc,CAAGX,CAAC,CAAC,IAAMI,CAAN,CAAoB,GAApB,CAA0BC,CAA3B,CAAD,CAAuCO,KAAvC,EARgB,CASrC,GAA8B,CAA1B,GAAAD,CAAc,CAACE,MAAnB,CAAiC,CAE7BP,CAAG,CAACE,IAAJ,CAAWR,CAAC,CAAC,IAAMI,CAAN,CAAoB,GAApB,CAA0BC,CAA1B,CAAsC,2BAAvC,CAAD,CAAmEO,KAAnE,GAA2EE,IAA3E,CAAgF,SAAhF,CAAX,CACAR,CAAG,CAACG,YAAJ,CAAmBT,CAAC,CAAC,IAAMI,CAAN,CAAoB,GAApB,CAA0BC,CAA1B,CAAsC,2BAAvC,CAAD,CAAmEO,KAAnE,GAA2EE,IAA3E,CAAgF,KAAhF,CAAnB,CAEA,GAAIH,CAAc,CAACG,IAAf,CAAoB,KAApB,UAAJ,CAA8C,CAC1CR,CAAG,CAACC,QAAJ,CAAeI,CAAc,CAACG,IAAf,CAAoB,KAApB,CAClB,CAFD,IAEO,CACHR,CAAG,CAACC,QAAJ,CAAeP,CAAC,CAAC,IAAMI,CAAN,CAAoB,GAApB,CAA0BC,CAA1B,CAAsC,SAAvC,CAAD,CAAmDO,KAAnD,GAA2DE,IAA3D,CAAgE,KAAhE,CAClB,CACDR,CAAG,CAACI,OAAJ,CAAcV,CAAC,CAAC,IAAMI,CAAN,CAAoB,GAApB,CAA0BC,CAA1B,CAAsC,SAAvC,CAAf,CAIAM,CAAc,CAACI,QAAf,CAAwB,eAAxB,EACAJ,CAAc,CAACI,QAAf,CAAwB,UAAxB,CACH,CAhBD,IAgBO,CAGH,GAAIC,CAAAA,CAAY,CAAGhB,CAAC,CAAC,IAAMI,CAAN,CAAoB,IAArB,CAAD,CAA4BQ,KAA5B,EAAnB,CACAN,CAAG,CAACC,QAAJ,CAAeS,CAAY,CAACF,IAAb,CAAkB,MAAlB,CAAf,CACAR,CAAG,CAACE,IAAJ,CAAWQ,CAAY,CAACF,IAAb,CAAkB,WAAlB,CAAX,CACAR,CAAG,CAACG,YAAJ,CAAmBO,CAAY,CAACF,IAAb,CAAkB,gBAAlB,CAAnB,CAGA,GAAIR,CAAG,CAACG,YAAJ,WAAmE,CAAjC,CAAAH,CAAG,CAACC,QAAJ,CAAaU,KAAb,CAAmB,GAAnB,EAAwBJ,MAA9D,CAA0E,CACtE,GAAIK,CAAAA,CAAS,CAAG,GAAIC,CAAAA,eAAJ,CAAoBb,CAAG,CAACC,QAAJ,CAAaU,KAAb,CAAmB,GAAnB,EAAwB,CAAxB,CAApB,CAAhB,CACAX,CAAG,CAACG,YAAJ,CAAmBS,CAAS,CAACE,GAAV,CAAc,gBAAd,CAAnB,CACAd,CAAG,CAACE,IAAJ,CAAWU,CAAS,CAACE,GAAV,CAAc,eAAd,CAAX,CACAd,CAAG,CAACC,QAAJ,CAAeA,QAAQ,CAACU,KAAT,CAAe,GAAf,EAAoB,CAApB,CAClB,CAGDD,CAAY,CAACD,QAAb,CAAsB,eAAtB,EACAC,CAAY,CAACD,QAAb,CAAsB,UAAtB,CACH,CACD,MAAOT,CAAAA,CACV,CA/CG,CAiDV,CAvDK,CAAN","sourcesContent":["/* jshint ignore:start */\ndefine(['jquery', 'core/log'], function ($, log) {\n\n    \"use strict\"; // jshint ;_;\n\n    log.debug('Media Parser: initialising');\n\n    return {\n       parse:  function(containerid, mediatype) {\n           var ret = {};\n           ret.mediaurl = false;\n           ret.lang = false;\n           ret.subtitlesurl = false;\n           ret.sources = false;\n\n           //do we have an audio player?\n           var originalplayer = $('#' + containerid + ' ' + mediatype).first();\n           if (originalplayer.length === 1) {\n\n               ret.lang = $('#' + containerid + ' ' + mediatype + ' track[kind=\"captions\"]').first().attr('srclang');\n               ret.subtitlesurl = $('#' + containerid + ' ' + mediatype + ' track[kind=\"captions\"]').first().attr('src');\n\n               if (originalplayer.attr('src') !== undefined) {\n                   ret.mediaurl = originalplayer.attr('src');\n               } else {\n                   ret.mediaurl = $('#' + containerid + ' ' + mediatype + ' source').first().attr('src');\n               }\n               ret.sources = $('#' + containerid + ' ' + mediatype + ' source');\n\n\n               //make sure moodle and poodll leave it alone from here on\n               originalplayer.addClass('nomediaplugin');\n               originalplayer.addClass('nopoodll');\n           } else {\n\n               //hopefully we have data attributes in the a link\n               var originallink = $('#' + containerid + ' a').first();\n               ret.mediaurl = originallink.attr('href');\n               ret.lang = originallink.attr('data-lang');\n               ret.subtitlesurl = originallink.attr('data-subtitles');\n\n               //but we might be in the old form where they were params on the url\n               if (ret.subtitlesurl === undefined && ret.mediaurl.split('?').length > 0) {\n                   var urlParams = new URLSearchParams(ret.mediaurl.split('?')[1]);\n                   ret.subtitlesurl = urlParams.get('data-subtitles');\n                   ret.lang = urlParams.get('data-language');\n                   ret.mediaurl = mediaurl.split('?')[0]\n               }\n\n               //make sure moodle and poodll leave it alone from here on\n               originallink.addClass('nomediaplugin');\n               originallink.addClass('nopoodll');\n           }\n           return ret; \n       }//end of parse function\n    };//end of returned object\n});//total end\n"],"file":"mediaparser.min.js"}