{"version":3,"sources":["../src/mediaparser.js"],"names":["define","$","log","debug","parse","containerid","mediatype","ret","mediaurl","lang","subtitlesurl","sources","imgurl","originalplayer","first","length","attr","addClass","originallink","JSON","stringify","split","urlParams","URLSearchParams","get","originalimg"],"mappings":"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","sourcesContent":["/* jshint ignore:start */\ndefine(['jquery', 'core/log'], function ($, log) {\n\n    \"use strict\"; // jshint ;_;\n\n    log.debug('Media Parser: initialising');\n\n    return {\n       parse:  function(containerid, mediatype) {\n           var ret = {};\n           ret.mediaurl = false;\n           ret.lang = false;\n           ret.subtitlesurl = false;\n           ret.sources = false;\n           ret.imgurl = false;\n\n           //do we have an audio player?\n           var originalplayer = $('#' + containerid + ' ' + mediatype).first();\n           if (originalplayer.length === 1) {\n               log.debug('processing player');\n               ret.lang = $('#' + containerid + ' ' + mediatype + ' track[kind=\"captions\"]').first().attr('srclang');\n               ret.subtitlesurl = $('#' + containerid + ' ' + mediatype + ' track[kind=\"captions\"]').first().attr('src');\n\n               if (originalplayer.attr('src') !== undefined) {\n                   ret.mediaurl = originalplayer.attr('src');\n               } else {\n                   ret.mediaurl = $('#' + containerid + ' ' + mediatype + ' source').first().attr('src');\n               }\n               ret.sources = $('#' + containerid + ' ' + mediatype + ' source');\n\n             /*  log.debug(JSON.stringify(ret)); */\n               //make sure moodle and poodll leave it alone from here on\n               originalplayer.addClass('nomediaplugin');\n               originalplayer.addClass('nopoodll');\n           } else {\n\n               //hopefully we have data attributes in the a link\n               var originallink = $('#' + containerid + ' a').first();\n               ret.mediaurl = originallink.attr('href');\n               ret.lang = originallink.attr('data-lang');\n               ret.subtitlesurl = originallink.attr('data-subtitles');\n               ret.imgurl = originallink.attr('data-img');\n               log.debug('processed link [1]');\n               log.debug(JSON.stringify(ret));\n\n               //but we might be in the old form where they were params on the url\n               if (ret.subtitlesurl === undefined && ret.mediaurl.split('?').length > 0) {\n                   log.debug('processing link [2]');\n                   log.debug(\"looking at the URL\");\n\n                   var urlParams = new URLSearchParams(ret.mediaurl.split('?')[1]);\n                   log.debug(ret.mediaurl.split('?')[1]);\n                   log.debug(JSON.stringify(urlParams));\n\n                   ret.subtitlesurl = urlParams.get('data-subtitles');\n                   ret.lang = urlParams.get('data-language');\n                   ret.mediaurl = ret.mediaurl.split('?')[0]\n               }\n\n               //make sure moodle and poodll leave it alone from here on\n               originallink.addClass('nomediaplugin');\n               originallink.addClass('nopoodll');\n           }\n\n           //do we have an image\n           if(!ret.imgurl) {\n               var originalimg = $('#' + containerid + ' img').first();\n               if (originalimg.length === 1) {\n                   ret.imgurl = originalimg.attr('src');\n               }\n           }\n\n           //clean up a cachekiller (or other) URL Param if it still exists because it can block cors\n           //there can be cross origin issues  if there are params, cos some templates use XHR, so just remove any params\n           //all templates should declare are video/audio tag with crossorigin set to anonymous, not pure js with xhr\n           ret.mediaurl = ret.mediaurl.split('?')[0]\n\n           return ret; \n       }//end of parse function\n    };//end of returned object\n});//total end\n"],"file":"mediaparser.min.js"}