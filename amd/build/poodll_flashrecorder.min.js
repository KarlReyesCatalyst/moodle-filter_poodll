define(["jquery","core/log","filter_poodll/uploader","filter_poodll/lzflash"],function(a,b,c,d){"use strict";return b.debug("PoodLL Flash Recorder: initialising"),{instanceprops:[],fetch_instance_props:function(a){return this.instanceprops[a]},init_instance_props:function(a){var b={};b.savebutton=null,b.audiodatacontrol=null,b.config=null,b.uploader=null,this.instanceprops[a]=b},supports_current_browser:function(a){var c=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;return c?!1:"audio"!=a.mediatype?!1:(b.debug("PoodLL Flash Recorder: supports this browser"),!0)},embed:function(b,e){1==e.flashmp3_cloudbypass&&(e.posturl=e.cloudbypassurl,e.filename=!1,e.s3filename=!1,e.using_s3=!1),this.init_instance_props(e.widgetid);var f=this.fetch_instance_props(e.widgetid);f.config=e;var g=a.parseJSON(e.flashmp3audio_widgetjson);d.embed.swf(g);var h=e.widgetid+"_savebutton",i='<button id="'+h+'" type="button" class="poodll_save-recording">'+M.util.get_string("recui_save","filter_poodll")+"</button>";a(b).append(i);var j=e.widgetid+"_audiodatacontrol",k='<input type="hidden" id="'+j+'"/>';a(b).prepend(k),f.uploader=c.clone(),f.uploader.init(b,e),d.embed[e.widgetid].setCanvasAttribute("audiodatacontrol",j),f.savebutton=a("#"+h),f.audiodatacontrol=a("#"+j),this.registerevents(e.widgetid)},registerevents:function(a){var b=this.fetch_instance_props(a);b.savebutton.click(function(){for(var a=atob(b.audiodatacontrol.val()),c=[],e=0;e<a.length;e++)c.push(a.charCodeAt(e));var f=new Blob([new Uint8Array(c)],{type:"audio/mpeg3"});b.uploader.uploadBlob(f,"audio/mpeg3");var g="poodllapi.mp3_disable()";return d.embed[b.config.widgetid].callMethod(g),!1})}}});