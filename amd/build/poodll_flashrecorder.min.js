define(["jquery","core/log","filter_poodll/utils_amd","filter_poodll/uploader","filter_poodll/lzflash"],function(a,b,c,d,e){"use strict";return b.debug("PoodLL Flash Recorder: initialising"),{instanceprops:[],fetch_instance_props:function(a){return this.instanceprops[a]},init_instance_props:function(a){var b={};b.savebutton=null,b.audiodatacontrol=null,b.config=null,b.uploader=null,this.instanceprops[a]=b},supports_current_browser:function(a){var d=c.is_ios(),e=c.is_android();return!(d||!a.flashonandroid&&e)&&("audio"==a.mediatype&&(b.debug("PoodLL Flash Recorder: supports this browser"),!0))},embed:function(b,c){1==c.flashmp3_cloudbypass&&(c.posturl=c.cloudbypassurl,c.filename=!1,c.s3filename=!1,c.using_s3=!1),this.init_instance_props(c.widgetid);var f=this.fetch_instance_props(c.widgetid);f.ie=this.is_ie(),f.ie&&(c.flashmp3audio_widgetjson=c.flashmp3audio_widgetjson.replace("sendmethod=post","sendmethod=ajax")),f.config=c;var g=a.parseJSON(c.flashmp3audio_widgetjson);e.embed.swf(g);var h="";f.ie&&(h=' style="display: none" ');var i=c.widgetid+"_savebutton",j='<button id="'+i+'" type="button" class="poodll_save-recording"'+h+">"+M.util.get_string("recui_save","filter_poodll")+"</button>";a(b).append(j);var k=c.widgetid+"_adc",l='<input type="hidden" name="audiodatacontrol" id="'+k+'" value="" />';a(b).prepend(l),f.uploader=d.clone(),f.uploader.init(b,c),e.embed[c.widgetid].setCanvasAttribute("audiodatacontrol",k),f.savebutton=a("#"+i),f.audiodatacontrol=a("#"+k),this.registerevents(c.widgetid)},registerevents:function(a){var b=this.fetch_instance_props(a);b.audioblob=!1,b.savebutton.click(function(){var a=atob(b.audiodatacontrol.val()),c=a&&a.length>0;if(!c&&!b.audioblob)return b.uploader.Output(M.util.get_string("recui_nothingtosaveerror","filter_poodll")),!1;if(!b.audioblob&&c){for(var d=[],f=0;f<a.length;f++)d.push(a.charCodeAt(f));b.audioblob=new Blob([new Uint8Array(d)],{type:"audio/mpeg3"})}b.uploader.uploadBlob(b.audioblob,"audio/mpeg3");var g="poodllapi.mp3_disable()";return e.embed[b.config.widgetid].callMethod(g),b.audiodatacontrol.val(""),!1})}}}),define(["jquery","core/log","filter_poodll/utils_amd","filter_poodll/uploader","filter_poodll/lzflash"],function(a,b,c,d,e){"use strict";return b.debug("PoodLL Flash Recorder: initialising"),{instanceprops:[],fetch_instance_props:function(a){return this.instanceprops[a]},init_instance_props:function(a){var b={};b.savebutton=null,b.audiodatacontrol=null,b.config=null,b.uploader=null,this.instanceprops[a]=b},supports_current_browser:function(a){var d=c.is_ios(),e=c.is_android();return!(d||!a.flashonandroid&&e)&&("audio"==a.mediatype&&(b.debug("PoodLL Flash Recorder: supports this browser"),!0))},embed:function(b,c){1==c.flashmp3_cloudbypass&&(c.posturl=c.cloudbypassurl,c.filename=!1,c.s3filename=!1,c.using_s3=!1),this.init_instance_props(c.widgetid);var f=this.fetch_instance_props(c.widgetid);f.ie=this.is_ie(),f.ie&&(c.flashmp3audio_widgetjson=c.flashmp3audio_widgetjson.replace("sendmethod=post","sendmethod=ajax")),f.config=c;var g=a.parseJSON(c.flashmp3audio_widgetjson);e.embed.swf(g);var h="";f.ie&&(h=' style="display: none" ');var i=c.widgetid+"_savebutton",j='<button id="'+i+'" type="button" class="poodll_save-recording"'+h+">"+M.util.get_string("recui_save","filter_poodll")+"</button>";a(b).append(j);var k=c.widgetid+"_adc",l='<input type="hidden" name="audiodatacontrol" id="'+k+'" value="" />';a(b).prepend(l),f.uploader=d.clone(),f.uploader.init(b,c),e.embed[c.widgetid].setCanvasAttribute("audiodatacontrol",k),f.savebutton=a("#"+i),f.audiodatacontrol=a("#"+k),this.registerevents(c.widgetid)},registerevents:function(a){var b=this.fetch_instance_props(a);b.audioblob=!1,b.savebutton.click(function(){var a=atob(b.audiodatacontrol.val()),c=a&&a.length>0;if(!c&&!b.audioblob)return b.uploader.Output(M.util.get_string("recui_nothingtosaveerror","filter_poodll")),!1;if(!b.audioblob&&c){for(var d=[],f=0;f<a.length;f++)d.push(a.charCodeAt(f));b.audioblob=new Blob([new Uint8Array(d)],{type:"audio/mpeg3"})}b.uploader.uploadBlob(b.audioblob,"audio/mpeg3");var g="poodllapi.mp3_disable()";return e.embed[b.config.widgetid].callMethod(g),b.audiodatacontrol.val(""),!1})}}});