define(["jquery","core/log","filter_poodll/uploader","filter_poodll/lzflash"],function(a,b,c,d){"use strict";return b.debug("PoodLL Flash Recorder: initialising"),{savebutton:null,audiodatacontrol:null,config:null,supports_current_browser:function(a){var c=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;return c?!1:"audio"!=a.mediatype?!1:(b.debug("PoodLL Flash Recorder: supports this browser"),!0)},embed:function(b,e){1==e.flashmp3_cloudbypass&&(e.posturl=e.cloudbypassurl,e.filename=!1,e.s3filename=!1,e.using_s3=!1),this.config=e;var f=a.parseJSON(e.flashmp3audio_widgetjson);d.embed.swf(f);var g=e.widgetid+"_savebutton",h='<button id="'+g+'" type="button" class="poodll_save-recording">'+M.util.get_string("recui_save","filter_poodll")+"</button>";a(b).append(h);var i=e.widgetid+"_audiodatacontrol",j='<input type="hidden" id="'+i+'"/>';a(b).prepend(j),c.init(b,e),d.embed[e.widgetid].setCanvasAttribute("audiodatacontrol",i),this.savebutton=a("#"+g),this.audiodatacontrol=a("#"+i),this.registerevents()},registerevents:function(){var a=this;this.savebutton.click(function(){for(var b=atob(a.audiodatacontrol.val()),e=[],f=0;f<b.length;f++)e.push(b.charCodeAt(f));var g=new Blob([new Uint8Array(e)],{type:"audio/mpeg3"});c.uploadBlob(g,"audio/mpeg3");var h="poodllapi.mp3_disable()";return d.embed[a.config.widgetid].callMethod(h),!1})}}});