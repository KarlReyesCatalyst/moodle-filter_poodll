define(["jquery","core/log","filter_poodll/MediaStreamRecorder","filter_poodll/gumadapter","filter_poodll/uploader"],function(a,b,c,d,e){"use strict";return b.debug("PoodLL Media Recorder: initialising"),{recorded_index:0,mediaRecorder:null,blobs:[],supports_current_browser:function(){return b.debug("PoodLL Media Recorder: supports this browser"),!0},embed:function(a,b){this.config=b,this.insert_controls(a),e.init(a,b),this.register_events()},insert_controls:function(b){var c=' <label for="time-interval">Time Interval (milliseconds):</label>';c+=' <input type="text" id="time-interval" value="5000">ms',c+='<br><select id="audio-mimeType" style="font-size:22px;vertical-align: middle;margin-right: 5px;">',c+=" <option>audio/webm</option>",c+=" <option>audio/wav</option>",c+=" </select>",c+='<button id="start-recording">Start</button>',c+='<button id="stop-recording" disabled>Stop</button>',c+='<button id="pause-recording" disabled>Pause</button>',c+=' <button id="resume-recording" disabled>Resume</button>',c+='<button id="save-recording" disabled>Save</button>',c+="<br><br>",c+='<input id="left-channel" type="checkbox" checked style="width:auto;">',c+='<label for="left-channel">Only Left Channel?</label>',c+='<section class="experiment">',c+='<div id="audios-container"></div>',c+="</section>",a(b).prepend(c)},onMediaError:function(a){console.error("media error",a)},captureUserMedia:function(a,b,c){navigator.mediaDevices.getUserMedia(a).then(b)["catch"](c)},bytesToSize:function(a){var b=1e3,c=["Bytes","KB","MB","GB","TB"];if(0===a)return"0 Bytes";var d=parseInt(Math.floor(Math.log(a)/Math.log(b)),10);return(a/Math.pow(b,d)).toPrecision(3)+" "+c[d]},getTimeLength:function(a){var b=new Date(a);return b.getUTCHours()+" hours, "+b.getUTCMinutes()+" minutes and "+b.getUTCSeconds()+" second(s)"},register_events:function(){var c={audio:!0},d=this,f=function(c){b.debug("onmediasuccess");var e=a("#time-interval").text();e=e?parseInt(e):5e3;var f=a("#audio-mimeType").val();d.mediaRecorder=new MediaStreamRecorder(c),d.mediaRecorder.mimeType=f,d.mediaRecorder.start(e),d.mediaRecorder.ondataavailable=function(a){d.blobs.push(a),b.debug("We got a blobby")},a("#stop-recording").attr("disabled",!1),a("#pause-recording").attr("disabled",!1),a("#save-recording").attr("disabled",!1)};a("#start-recording").click(function(){this.disabled=!0,d.captureUserMedia(c,f,d.onMediaError)}),a("#stop-recording").click(function(){this.disabled=!0,d.mediaRecorder.stop(),a("#pause-recording").attr("disabled",!0),a("#start-recording").attr("disabled",!1)}),a("#pause-recording").click(function(){this.disabled=!0,d.mediaRecorder.pause(),a("#resume-recording").attr("disabled",!1)}),a("#resume-recording").click(function(){this.disabled=!0,d.mediaRecorder.resume(),a("#pause-recording").attr("disabled",!1)}),a("#save-recording").click(function(){this.disabled=!0,b.debug(d.blobs[0].type),ConcatenateBlobs(d.blobs,d.blobs[0].type,function(a){e.uploadBlob(a,d.blobs[0].type)})}),window.onbeforeunload=function(){a("#start-recording").attr("disabled",!1)}}}});