define(["jquery","core/log","filter_poodll/uploader"],function(a,b,c){"use strict";return b.debug("PoodLL Mobile Recorder: initialising"),{supports_current_browser:function(){var a=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;return a},embed:function(a,b){switch(this.config=b,this.linkid="filter_poodll_mobilerecorder_link_"+b.widgetid,b.mediatype){case"audio":this.insert_audio_button(a,this.linkid);break;case"video":this.insert_video_button(a,this.linkid)}return c.init(a,b),this.register_events(),!0},register_events:function(){var b=(this.config,this);a("#"+this.linkid).on("mousedown touchstart",function(a){b.confirm_s3_arrival(),c.Output("awaiting confirmation")})},insert_video_button:function(b){var c='<a class ="filter_poodll_mobilerecorderlink" id="'+this.linkid+'" href="poodllproto:record?filename='+this.config.s3filename+"&type="+this.config.mediatype+"&s3folder=&timelimit="+this.config.timelimit+'">open recorder</a>';a(b).prepend(c)},insert_audio_button:function(b){var c='<a class ="filter_poodll_mobilerecorderlink"  id="'+this.linkid+'" href="poodllproto:record?filename='+this.config.s3filename+"&type="+this.config.mediatype+"&s3folder=&timelimit="+this.config.timelimit+'">open recorder</a>';a(b).prepend(c)},confirm_s3_arrival:function(){var a=new XMLHttpRequest,b=this.config,d=b.wwwroot+"/filter/poodll/poodllfilelib.php",e="datatype=confirmarrival";e+="&mediatype="+b.mediatype,e+="&filename="+b.filename,a.open("POST",d,!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.setRequestHeader("Cache-Control","no-cache"),a.setRequestHeader("Content-length",e.length),a.setRequestHeader("Connection","close"),a.addEventListener("load",function(){a.response&&a.response.indexOf(b.filename)>0?(c.pokeFilename(b.filename,c),c.postprocess_s3_upload(c),c.Output("filereceived")):setTimeout(function(){a.open("POST",d,!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.setRequestHeader("Cache-Control","no-cache"),a.setRequestHeader("Content-length",e.length),a.setRequestHeader("Connection","close"),a.send(e)},2e3)}),a.send(e)}}});