define(["jquery","core/log","filter_poodll/uploader","filter_poodll/webcam"],function(a,b,c,d){"use strict";return b.debug("PoodLL Snapshot Recorder: initialising"),{config:null,imagefile:!1,htmlthings:"",supports_current_browser:function(a){var c=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;return c?!1:"snapshot"!=a.mediatype?!1:(b.debug("PoodLL Snapshot Recorder: supports this browser"),!0)},embed:function(a,b){this.config=b,this.insert_controls(a),c.init(a,b),this.register_events()},insert_controls:function(b){var c=this.config,d={camera:c.widgetid+"_poodll_snapshot_camera",preview:c.widgetid+"_poodll_snapshot_preview",snapbutton:c.widgetid+"_poodll_take-snapshot",savebutton:c.widgetid+"_poodll_save-snapshot",cancelbutton:c.widgetid+"_poodll_cancel-snapshot"};this.htmlthings=d;var e='<div id="'+d.camera+'" style="width:320px; height:240px;"></div>';e+='<div id="'+d.preview+'" class="hide" style="width:320px; height:240px;"></div>',e+='<button type="button" class="poodll_take-snapshot" id="'+d.snapbutton+'">'+M.util.get_string("recui_takesnapshot","filter_poodll")+"</button>",e+='<button type="button" class="poodll_cancel-snapshot" id="'+d.cancelbutton+'">'+M.util.get_string("recui_cancelsnapshot","filter_poodll")+"</button>",e+='<button type="button" class="poodll_save-recording" id="'+d.savebutton+'">'+M.util.get_string("recui_save","filter_poodll")+"</button>",a(b).prepend(e)},register_events:function(){var b=this;this.config;d.set("swfURL",M.cfg.wwwroot+"/filter/poodll/3rdparty/webcam/webcam.swf"),d.attach("#"+this.htmlthings.camera),a("#"+this.htmlthings.savebutton).on("click",function(a){if(b.imagefile){var d="image/jpeg",e=c.dataURItoBlob(b.imagefile,d);c.uploadFile(e,d)}else c.Output(M.util.get_string("recui_nothingtosaveerror","filter_poodll"))}),a("#"+this.htmlthings.cancelbutton).on("click",function(c){b.imagefile=!1,a("#"+b.htmlthings.preview).addClass("hide").html(""),a("#"+b.htmlthings.camera).removeClass("hide")}),a("#"+this.htmlthings.snapbutton).on("click",function(c){d.snap(function(c){b.imagefile=c,a("#"+b.htmlthings.preview).html('<img src="'+c+'"/>').removeClass("hide"),a("#"+b.htmlthings.camera).addClass("hide")})})}}});