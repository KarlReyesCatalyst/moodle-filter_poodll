{"version":3,"sources":["../src/speech_browser.js"],"names":["define","$","log","debug","recognition","recognizing","ignore_onend","final_transcript","start_timestamp","lang","clone","extend","init","SpeechRecognition","webkitSpeechRecognition","continuous","interimResults","register_events","set_grammar","grammar","SpeechGrammarList","webkitSpeechGrammarList","speechRecognitionList","addFromString","grammars","start","Date","now","stop","that","onstart","onerror","event","error","timeStamp","onend","onresult","interim_transcript","i","resultIndex","results","length","isFinal","transcript","onfinalspeechcapture","oninterimspeechcapture","speechtext"],"mappings":"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","sourcesContent":["/* jshint ignore:start */\ndefine(['jquery', 'core/log'], function ($, log) {\n\n    \"use strict\"; // jshint ;_;\n\n    log.debug('speech_browser: initialising');\n\n    return {\n\n        recognition: null,\n        recognizing: false,\n        ignore_onend: false,\n        final_transcript: '',\n        start_timestamp: 0,\n        lang: 'en-US',\n\n\n        //for making multiple instances\n        clone: function () {\n            return $.extend(true, {}, this);\n        },\n\n        init: function (lang) {\n            var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition;\n            this.recognition = new SpeechRecognition();\n            this.recognition.continuous = true;\n            this.recognition.interimResults = true;\n            this.lang = lang ? lang : 'en-US';\n\n            this.register_events();\n        },\n\n        set_grammar: function (grammar) {\n            var SpeechGrammarList = SpeechGrammarList || webkitSpeechGrammarList;\n            if (SpeechGrammarList) {\n                var speechRecognitionList = new SpeechGrammarList();\n                speechRecognitionList.addFromString(grammar, 1);\n                this.recognition.grammars = speechRecognitionList;\n            }\n        },\n\n        start: function () {\n            if (this.recognizing) {\n                return;\n            }\n            this.recognizing = true;\n            this.final_transcript = '';\n            this.recognition.lang = this.lang;//select_dialect.value;\n            this.recognition.start();\n            this.ignore_onend = false;\n            this.start_timestamp = Date.now();//event.timeStamp;\n\n        },\n        stop: function () {\n            // if (this.recognizing) {\n            this.recognizing = false;\n            this.recognition.stop();\n            return;\n            //}\n        },\n\n        register_events: function () {\n\n            var recognition = this.recognition;\n            var that = this;\n\n            recognition.onstart = function () {\n                that.recognizing = true;\n\n            };\n            recognition.onerror = function (event) {\n                if (event.error == 'no-speech') {\n                    log.debug('info_no_speech');\n                    that.ignore_onend = true;\n                }\n                if (event.error == 'audio-capture') {\n                    log.debug('info_no_microphone');\n                    that.ignore_onend = true;\n                }\n                if (event.error == 'not-allowed') {\n                    if (event.timeStamp - that.start_timestamp < 100) {\n                        log.debug('info_blocked');\n                    } else {\n                        log.debug('info_denied');\n                    }\n                    that.ignore_onend = true;\n                }\n            };\n            recognition.onend = function () {\n                //that.recognizing = false;\n\n                // we restart by default\n                // we might need to be more clever here\n                if (that.recognizing == false) {\n                    return;\n                }\n                if (that.ignore_onend) {\n                    that.recognizing = false;\n                } else {\n                    recognition.start();\n                }\n\n            };\n            recognition.onresult = function (event) {\n                var interim_transcript = '';\n                for (var i = event.resultIndex; i < event.results.length; ++i) {\n                    if (event.results[i].isFinal) {\n                        that.final_transcript += event.results[i][0].transcript;\n                        that.onfinalspeechcapture(that.final_transcript);\n                        that.final_transcript = '';\n                    } else {\n                        interim_transcript += event.results[i][0].transcript;\n                        that.oninterimspeechcapture(interim_transcript);\n                    }\n                }\n\n\n            };\n        },//end of register events\n\n        onfinalspeechcapture: function (speechtext) {\n            log.debug(speechtext);\n        },\n        oninterimspeechcapture: function (speechtext) {\n            // log.debug(speechtext);\n        }\n\n    };//end of returned object\n});//total end\n"],"file":"speech_browser.min.js"}